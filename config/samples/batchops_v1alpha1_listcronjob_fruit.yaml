apiVersion: batchops.io/v1alpha1
kind: ListCronJob
metadata:
  name: fruit-processor
spec:
  listSourceRef: "fruit-list"  # References the ListSource we created earlier
  parallelism: 2  # Process 2 items at a time
  template:
    image: "busybox"
    command: ["echo", "Processing fruit: $ITEM"]
    envName: "ITEM"
    labels:
      app: "fruit-processor"
      component: "worker"
    volumes:
      - name: data
        emptyDir: {}
      # Example: Mount a ConfigMap as a volume
      # - name: config
      #   configMap:
      #     name: my-config
    volumeMounts:
      - name: data
        mountPath: /data
      # Example: Mount the ConfigMap
      # - name: config
      #   mountPath: /etc/config
      #   readOnly: true
    ports:
      - containerPort: 8080
        name: http
        protocol: TCP
      # Example: Add more ports
      # - containerPort: 9090
      #   name: metrics
      #   protocol: TCP
    initContainers:
      # Example: Run a custom init container before the parallax-init container
      - name: setup
        image: busybox
        command: ["sh", "-c", "echo 'Setting up...' && sleep 1"]
      # Example: Download dependencies
      # - name: download-deps
      #   image: curlimages/curl
      #   command: ["sh", "-c", "curl -o /data/config.json https://example.com/config.json"]
      #   volumeMounts:
      #     - name: data
      #       mountPath: /data
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"
  schedule: "*/5 * * * *"  # Run every 5 minutes
  concurrencyPolicy: "Forbid"  # Don't allow concurrent runs
  startingDeadlineSeconds: 60  # Allow 60 seconds of delay before considering a run failed
  successfulJobsHistoryLimit: 3  # Keep history of last 3 successful runs
  failedJobsHistoryLimit: 1  # Keep history of last failed run
  suspend: false  # Don't suspend the CronJob 